<!DOCTYPE html>
<html class='h-100' lang='ru' prefix='og: https://ogp.me/ns#'>

<head>
  <title>Конфигурация - PHP: Laravel</title>
  <meta name="csrf-param" content="authenticity_token" />
  <meta name="csrf-token"
    content="TULpcOXMBLwOkmHi4CgKLTjUEbDtID4Ntk1NBjKxv5O0C5tFEAgdwBdS5MGvuJm3Rnxa-yepm5W9bWpn78jNnA" />
  <meta name="csp-nonce" />
  <link rel="shortcut icon" type="image/x-icon"
    href="https://cdn2.hexlet.io/assets/favicon-8fa102c058afb01de5016a155d7db433283dc7e08ddc3c4d1aef527c1b8502b6.ico" />
  <meta content='width=device-width, initial-scale=1.0' name='viewport'>
  <meta charset='utf-8'>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>

<body class='h-100'>
  <div class='d-flex flex-column flex-md-row h-100'>
    <div class='x-border-md-right flex-fill tab-content overflow-hidden h-100'>
      <div aria-labelledby='lesson-tab' class='tab-pane fade show active overflow-auto h-100' id='lesson'
        role='tabpanel'>
        <div class='container-xl my-3 mb-md-4 mb-lg-5'>
          <div class='row justify-content-center'>
            <div class='col-12 col-lg-10'>
              <a class="small" data-toggle="collapse" href="theory_unit.html#tips">Ошибки, сложный материал, вопросы
                &gt;</a>
              <div class='collapse' id='tips'>
                <div class='py-3 px-4 x-line-height-15 bg-hexlet-gray mt-3'>
                  <h6 class='font-weight-bold'>Нашли опечатку или неточность?</h6>
                  <p>
                    Выделите текст, нажмите
                    <kbd class='bg-secondary'>ctrl + enter</kbd>
                    и отправьте его нам. В течение нескольких дней мы исправим ошибку или улучшим формулировку.
                  </p>
                  <h6 class='font-weight-bold'>Что-то не получается или материал кажется сложным?</h6>
                  <p class='mb-1'>Загляните в раздел «Обсуждение»:</p>
                  <ul>
                    <li>задайте вопрос. Вы быстрее справитесь с трудностями и прокачаете навык постановки правильных
                      вопросов, что пригодится и в учёбе, и в работе программистом;</li>
                    <li>расскажите о своих впечатлениях. Если курс слишком сложный, подробный отзыв поможет нам сделать
                      его лучше;</li>
                    <li>изучите вопросы других учеников и ответы на них. Это база знаний, которой можно и нужно
                      пользоваться.</li>
                  </ul>
                  <h6 class='font-weight-bold'>Об обучении на Хекслете</h6>
                  <ul class='list-unstyled mb-0'>
                    <li>
                      Статья «<a target="_blank" href="https://guides.hexlet.io/learning">Как учиться и справляться с
                        негативными мыслями</a>»
                    </li>
                    <li>
                      Статья «<a target="_blank" href="https://ru.hexlet.io/blog/posts/traps-learning">Ловушки
                        обучения</a>»
                    </li>
                    <li>
                      Статья «<a target="_blank"
                        href="https://ru.hexlet.io/blog/posts/slozhnye-prostye-zadachi-po-programmirovaniyu">Сложные
                        простые задачи по программированию</a>»
                    </li>
                    <li>
                      Урок «<a target="_blank"
                        href="https://ru.hexlet.io/courses/introduction_to_programming/lessons/hexlet-flow/theory_unit">Как
                        эффективно учиться на Хекслете</a>»
                    </li>
                    <li>
                      Вебинар «<a target="_blank" rel="noopener noreferrer nofollow"
                        href="https://www.youtube.com/watch?v=dCYZppVgGww">Как самостоятельно учиться</a>»
                    </li>
                  </ul>
                </div>
              </div>

              <div class='mt-3 paywall'>
                <div class='p-2 p-md-4 shadow-sm bg-white'>
                  <div class='hexlet-markdown-body overflow-hidden p-2 p-md-4'>
                    <a class="h6 mb-0 font-weight-normal text-muted x-link-only-hover"
                      href="../resource/exercise_unit.html">PHP: Laravel</a>
                    <h1 class='mt-0 mb-4'>Конфигурация</h1>
                    <h2 id="peremennye-okruzheniya">Переменные окружения</h2>
                    <p>Любое нетривиальное приложение взаимодействует с внешним миром: использует базу данных,
                      обращается к внешним сервисам (например, платёжным), отправляет письма и получает список друзей,
                      например, из Facebook. Для подавляющего большинства этих операций необходимы специальные
                      параметры: ключи, пароли, адреса серверов и порты. Все эти параметры называются конфигурацией
                      приложения.</p>

                    <p>Возникает вопрос, где хранить конфигурацию? Самый простой и самый неправильный ответ – прямо в
                      приложении. Проблем у такого подхода две:</p>

                    <ul>
                      <li>Часть этих данных секретная. Хранить их в репозитории просто нельзя из-за возможных проблем с
                        безопасностью. Любой кто имеет доступ к репозиторию сможет получить любой доступ. Правда ещё
                        есть вариант с шифрованием, но он выходит за рамки обсуждаемой темы (для интересующихся <a
                          href="https://docs.ansible.com/ansible/latest/user_guide/vault.html" target="_blank"
                          rel="nofollow">Ansible Vault</a>).</li>
                      <li>При изменении этих параметров придётся заново &quot;деплоить&quot; (то есть выкладывать) сайт,
                        хотя, по сути, ничего не изменилось, нет новых фич, нет исправления старых багов. Просто
                        изменилась конфигурация.</li>
                    </ul>

                    <p>В 2011 году разработчики компании <a href="https://www.heroku.com/" target="_blank"
                        rel="nofollow">Heroku</a> выложили в интернете сайт, который называется <a
                        href="https://12factor.net/ru/" target="_blank" rel="nofollow">12factors</a>. Он описывает
                      методологию для создания веб-приложений, которая уменьшает затраты на установку и настройку
                      приложения, повышает переносимость между средами исполнения, позволяет масштабироваться без
                      существенных изменений в инструментах, архитектуре и практике разработки. С тех пор эта
                      методология фактически стала стандартом в индустрии.</p>

                    <p>Я крайне рекомендую прочитать этот документ целиком, но прямо сейчас нас интересует один его
                      аспект – конфигурация. 12 факторов требуют строгого разделения конфигурации и кода. Конфигурация
                      может меняться между развёртываниями (локальное окружение разработчика, продакшен, среда для
                      тестирования), код – нет. Конфигурация должна передаваться в приложение снаружи, и единственный
                      универсальный способ сделать это — использовать переменные окружения.</p>

                    <p>Laravel имеет большое число настроек для разных подсистем, которые задаются через переменные
                      окружения. Например вот как можно запустить фреймворк в режиме отладки:</p>
                    <pre class="hljs"><code class=sh><span style="color: #999988;font-style: italic"># при запуске устанавливается переменная окружения APP_DEBUG со значением true</span>
<span style="color: #008080">$ APP_DEBUG</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #0086B3">true </span>php artisan serve
</code></pre>
                    <p>Таких переменных довольно много, они отвечают за настройку кеширования, за отправку почты и
                      многое другое. Для простоты конфигурации, Laravel использует библиотеку <a
                        href="https://github.com/vlucas/phpdotenv" target="_blank" rel="nofollow">phpdotenv</a>, которая
                      позволяет загружать переменные не только из окружения, но и из специального файла <em>.env</em>,
                      находящегося в корне проекта. Этот файл не хранится в репозитории, так как он специфичен для
                      окружения, в котором идёт запуск. Вот его небольшой кусок:</p>
                    <pre class="hljs"><code class=sh><span style="color: #008080">APP_NAME</span><span style="color: #000000;font-weight: bold">=</span>Laravel
<span style="color: #008080">APP_ENV</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #0086B3">local
</span><span style="color: #008080">APP_KEY</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #0086B3">base64</span>:MUD1rJ2GkEp7P5PdlsGe5MGfdwxu0v08IVDLodGW3zE<span style="color: #000000;font-weight: bold">=</span>
<span style="color: #008080">APP_DEBUG</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #0086B3">true
</span><span style="color: #008080">APP_URL</span><span style="color: #000000;font-weight: bold">=</span>http://localhost

<span style="color: #008080">LOG_CHANNEL</span><span style="color: #000000;font-weight: bold">=</span>stack

<span style="color: #008080">BROADCAST_DRIVER</span><span style="color: #000000;font-weight: bold">=</span>log
<span style="color: #008080">CACHE_DRIVER</span><span style="color: #000000;font-weight: bold">=</span>file
<span style="color: #008080">QUEUE_CONNECTION</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #0086B3">sync
</span><span style="color: #008080">SESSION_DRIVER</span><span style="color: #000000;font-weight: bold">=</span>file
<span style="color: #008080">SESSION_LIFETIME</span><span style="color: #000000;font-weight: bold">=</span>120
</code></pre>
                    <p>Это обычный текстовый файл, в каждой строке которого находится имя переменной и её значение.
                      Laravel автоматически подгружает его и затем, эти переменные используются в коде (если они там
                      используются конечно).</p>

                    <p>Возможно у вас возникает вопрос, каким образом формируется этот файл? После генерации проекта,
                      Laravel создаёт файл .env.example, который хранится в репозитории, а в момент выполнения команды
                      <em>composer install</em> он копируется в файл <em>.env</em>. Благодаря этому проект на Laravel
                      стартует из коробки без необходимости дополнительной конфигурации. По крайней мере в режиме
                      разработки. А вот для конфигурации продакшен-окружения одним фреймворком не обойтись. Здесь нужно
                      применять либо системы управления конфигурацией, такие как <a href="https://www.ansible.com/"
                        target="_blank" rel="nofollow">Ansible</a>, либо использовать системы оркестрации, например, <a
                        href="https://kubernetes.io/" target="_blank" rel="nofollow">Kubernetes</a>, либо системы
                      подобные <a href="https://www.vaultproject.io/" target="_blank" rel="nofollow">Vault</a>.</p>
                    <h2 id="baza-dannyh">База данных</h2>
                    <p>По умолчанию Laravel хочет взаимодействовать с MySQL, одной из самых популярных баз данных
                      используемых в веб-разработке (наряду с PostgreSQL). Мы же поменяем базу данных и запустим наше
                      приложение с SQLite. SQLite крайне проста в первоначальной настройке и запуске, это позволит нам
                      прямо сейчас не отвлекаться на борьбу с операционной системой.</p>

                    <p><em>Учтите что SQLite нельзя использовать в конкурентной среде, то есть там где много
                        пользователей. Она на это не рассчитана. Основное применение SQLite это мобильные приложения,
                        настольные приложения (например, браузеры). Ещё SQLite используют как базу данных для прогона
                        тестов или запуска сайта в режиме разработки. Последнее это наш случай.</em></p>

                    <p>SQLite хранит данные в обычном файле. Создадим его:</p>
                    <pre class="hljs"><code class=sh><span style="color: #999988;font-style: italic"># Это место, куда по умолчанию смотрит Laravel в поиске SQLite базы данных</span>
<span style="color: #008080">$ </span><span style="color: #0086B3">touch </span>database/database.sqlite
</code></pre>
                    <p>Этот файл не может находится в репозитории, поскольку он изменяется при любых изменениях данных.
                      Laravel уже учёл это, добавив все файлы с расширением <em>sqlite</em> в <em>.gitignore</em>.</p>

                    <p>Теперь необходимо настроить приложение так, чтобы оно начало использовать SQLite. Для этого
                      откройте <em>.env</em> и установите там тип соединения:</p>
                    <pre class="hljs"><code class=sh><span style="color: #008080">DB_CONNECTION</span><span style="color: #000000;font-weight: bold">=</span>sqlite
</code></pre>
                    <p>Кроме того, нужно закомментировать или удалить переменную окружения <em>DB_DATABASE</em>. В таком
                      случае Laravel попробует искать файл с базой данных по пути <em>database/database.sqlite</em>.</p>

                    <p>Проверить что подключение работает можно в репле:</p>
                    <pre class="hljs"><code class=sh><span style="color: #008080">$ </span>php artisan tinker
Psy Shell v0.10.0 <span style="color: #000000;font-weight: bold">(</span>PHP 7.3.11 — cli<span style="color: #000000;font-weight: bold">)</span> by Justin Hileman
<span style="color: #000000;font-weight: bold">&gt;&gt;&gt;</span> DB::select<span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">'select 1'</span><span style="color: #000000;font-weight: bold">)</span>
<span style="color: #999988;font-style: italic"># Если нет ошибок, значит все хорошо</span>
</code></pre>
                    <h2 id="samostoyatelnaya-rabota">Самостоятельная работа</h2>
                    <ol>
                      <li> Изучите файл <em>.env.example</em>.</li>
                      <li> Найдите в <em>composer.json</em> код, который отвечает за копирование <em>.env.example</em> в
                        <em>.env</em>.</li>
                      <li> Настройте подключение к SQLite и проверьте что оно работает. Возможно вам понадобится
                        установить в систему пакет, который подключает sqlite3 к PHP. Точнее имя пакета зависит от
                        системы и версии PHP.</li>
                    </ol>

                    <hr class='my-5'>
                    <h4 class='mb-4'>Дополнительные материалы</h4>
                    <ol>
                      <li class='lead'>
                        <a target="_blank" href="https://laravel.com/docs/8.x/configuration">Конфигурация Laravel</a>
                      </li>
                    </ol>
                    <div class="d-flex justify-content-center">
                      <a href="./exercise_unit.html" type="button" class="btn btn-dark">Задача</a>
                    </div>

</body>

</html>