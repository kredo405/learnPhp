<!DOCTYPE html>
<html class='h-100' lang='ru' prefix='og: https://ogp.me/ns#'>
<head>
<title>Условия (WHERE) - Основы реляционных баз данных</title>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="yngt1bgTrwWzebvnKba-AclydOYAcYO1dpmKbjalytUzpYO-SzryIoGM6QrEHn2G12UVtx9TiQIkyRDx_WSV3Q" />
<meta name="csp-nonce" />
<link rel="shortcut icon" type="image/x-icon" href="https://cdn2.hexlet.io/assets/favicon-8fa102c058afb01de5016a155d7db433283dc7e08ddc3c4d1aef527c1b8502b6.ico" />
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<meta charset='utf-8'>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>
<body class='h-100'>
<div class='d-flex flex-column flex-md-row h-100'>
<div class='x-border-md-right flex-fill tab-content overflow-hidden h-100'>
<div aria-labelledby='lesson-tab' class='tab-pane fade show active overflow-auto h-100' id='lesson' role='tabpanel'>
<div class='container-xl my-3 mb-md-4 mb-lg-5'>
<div class='row justify-content-center'>
<div class='col-12 col-lg-10'>
<a class="small" data-toggle="collapse" href="theory_unit.html#tips">Ошибки, сложный материал, вопросы &gt;</a>
<div class='collapse' id='tips'>
<div class='py-3 px-4 x-line-height-15 bg-hexlet-gray mt-3'>
<h6 class='font-weight-bold'>Нашли опечатку или неточность?</h6>
<p>
Выделите текст, нажмите
<kbd class='bg-secondary'>ctrl + enter</kbd>
и отправьте его нам. В течение нескольких дней мы исправим ошибку или улучшим формулировку.
</p>
<h6 class='font-weight-bold'>Что-то не получается или материал кажется сложным?</h6>
<p class='mb-1'>Загляните в раздел «Обсуждение»:</p>
<ul>
<li>задайте вопрос. Вы быстрее справитесь с трудностями и прокачаете навык постановки правильных вопросов, что пригодится и в учёбе, и в работе программистом;</li>
<li>расскажите о своих впечатлениях. Если курс слишком сложный, подробный отзыв поможет нам сделать его лучше;</li>
<li>изучите вопросы других учеников и ответы на них. Это база знаний, которой можно и нужно пользоваться.</li>
</ul>
<h6 class='font-weight-bold'>Об обучении на Хекслете</h6>
<ul class='list-unstyled mb-0'>
<li>
Статья «<a target="_blank" href="https://guides.hexlet.io/learning">Как учиться и справляться с негативными мыслями</a>»
</li>
<li>
Статья «<a target="_blank" href="https://ru.hexlet.io/blog/posts/traps-learning">Ловушки обучения</a>»
</li>
<li>
Статья «<a target="_blank" href="https://ru.hexlet.io/blog/posts/slozhnye-prostye-zadachi-po-programmirovaniyu">Сложные простые задачи по программированию</a>»
</li>
<li>
Урок «<a target="_blank" href="https://ru.hexlet.io/courses/introduction_to_programming/lessons/hexlet-flow/theory_unit">Как эффективно учиться на Хекслете</a>»
</li>
<li>
Вебинар «<a target="_blank" rel="noopener noreferrer nofollow" href="https://www.youtube.com/watch?v=dCYZppVgGww">Как самостоятельно учиться</a>»
</li>
</ul>
</div>
</div>

<div class='mt-3 paywall'>
<div class='p-2 p-md-4 shadow-sm bg-white'>
<div class='hexlet-markdown-body overflow-hidden p-2 p-md-4'>
<a class="h6 mb-0 font-weight-normal text-muted x-link-only-hover" href="../transactions/exercise_unit.html">Основы реляционных баз данных</a>
<h1 class='mt-0 mb-4'>Условия (WHERE)</h1>
<h2 id="where">WHERE</h2>
<p>Самое простое условие — указание прямого соответствия. Например, выборка по идентификатору:</p>
<pre class="hljs"><code class=sql><span style="color: #999988;font-style: italic">-- В случае базы данных знак `=` должен восприниматься</span>
<span style="color: #999988;font-style: italic">-- как математическое равенство, а не присваивание.</span>
<span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span> <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">users</span> <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">id</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">3</span><span style="background-color: #f8f8f8">;</span>

<span style="color: #000000;font-weight: bold">UPDATE</span> <span style="background-color: #f8f8f8">users</span> <span style="color: #000000;font-weight: bold">SET</span> <span style="background-color: #f8f8f8">first_name</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">'Valya'</span> <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">id</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">3</span><span style="background-color: #f8f8f8">;</span>

<span style="color: #000000;font-weight: bold">DELETE</span> <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">users</span> <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">id</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">3</span><span style="background-color: #f8f8f8">;</span>
</code></pre>
<p>Первый запрос выше звучит так: выбрать всех пользователей, у которых идентификатор равен трём. Вероятно, такая формулировка звучит странно. Раз мы выбираем по идентификатору, то и запись должна быть одна? Да, с точки зрения семантики идентификатора (каждый пользователь имеет уникальный идентификатор) она будет одна. Но важно не забывать, что наша база данных реляционная и в реляционной базе данных результатом любой операции над множеством (отношением) является множество! В случае если ничего не найдено, возвращается не &quot;пустота&quot;, а пустое множество. Если же в базе есть пользователь с указанным идентификатором, то вернётся множество, содержащее один элемент — найденного пользователя.</p>

<p>Если нужно получить все записи, <strong>кроме</strong> тех, что имеют определённое значение (даже если запись одна), то нужно <code>=</code> (&quot;равно&quot;), заменить на <code>!=</code> (&quot;НЕ равно&quot;):</p>
<pre class="hljs"><code class=sql><span style="color: #999988;font-style: italic">-- выбрать всех пользователей с идентификатором, НЕ равным трём</span>
<span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span> <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">users</span> <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">id</span> <span style="color: #000000;font-weight: bold">!=</span> <span style="color: #009999">3</span><span style="background-color: #f8f8f8">;</span>
</code></pre><h2 id="proverka-na-ravenstvo-s-null">Проверка на равенство с NULL</h2>
<p>Сравнение с конкретным значением работает для всех типов данных, кроме <code>NULL</code>. У последнего свой собственный синтаксис.</p>

<p>Равно <code>NULL</code>:</p>
<pre class="hljs"><code class=sql><span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span> <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">users</span> <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">first_name</span> <span style="color: #000000;font-weight: bold">IS</span> <span style="color: #000000;font-weight: bold">NULL</span><span style="background-color: #f8f8f8">;</span>
</code></pre>
<p>Не равно <code>NULL</code>:</p>
<pre class="hljs"><code class=sql><span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span> <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">users</span> <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">created_at</span> <span style="color: #000000;font-weight: bold">IS</span> <span style="color: #000000;font-weight: bold">NOT</span> <span style="color: #000000;font-weight: bold">NULL</span><span style="background-color: #f8f8f8">;</span>
</code></pre>
<p><code>NOT</code>, как и отрицание в языках программирования, может добавляться практически к любому оператору.</p>
<h2 id="ravenstvo-strok">Равенство строк</h2>
<p>Работа со строками тоже имеет свои особенности. В соответствии со стандартом ANSI SQL, строки в PostgreSQL <strong>регистрозависимые</strong>. Это значит, что следующие два запроса выбирают разные данные:</p>
<pre class="hljs"><code class=sql><span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span> <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">users</span> <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">first_name</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">'sunny'</span><span style="background-color: #f8f8f8">;</span>
<span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span> <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">users</span> <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">first_name</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">'Sunny'</span><span style="background-color: #f8f8f8">;</span>
</code></pre>
<p>По этой причине данные в базе стараются хранить в <strong>нормализованном</strong> виде. То есть, перед добавлением в БД их приводят, например, к нижнему регистру, и то же самое делают при выборках. Классический пример — email. Его нужно хранить только в нижнем регистре.</p>
<h2 id="drugie-operatsii-sravneniya">Другие операции сравнения</h2>
<p><img alt="Работа WHERE" class="lazyload px-2 px-md-3 px-lg-4 px-xl-5" data-src="https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6IjI3MzdjNmRlZjUyOGY5MWRmMjQwNTFmYzQ2ZjZmNDJjLmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=7f90ca940bfc0c6ec80548a1429f308308e45bba5c99ad8cfbb5ecddaa23d6fe" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" /></p>

<p>Кроме точного соответствия, SQL поддерживает и все остальные операции сравнения: <code>&gt;</code> (больше), <code>&lt;</code> (меньше), <code>!=</code> (не равно), <code>&gt;=</code> (больше либо равно, &quot;не меньше&quot;), <code>&lt;=</code> (меньше либо равно, &quot;не больше&quot;).</p>
<pre class="hljs"><code class=sql><span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span>
  <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">users</span>
  <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">created_at</span> <span style="color: #000000;font-weight: bold">&lt;</span> <span style="color: #d14">'2018-10-05'</span><span style="background-color: #f8f8f8">;</span>
</code></pre><h2 id="logicheskie-operatory">Логические операторы</h2>
<p>В свою очередь все операции можно объединять в цепочки, используя <strong>логические операторы</strong> <code>OR</code> и <code>AND</code>:</p>
<pre class="hljs"><code class=sql><span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span>
  <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">users</span>
  <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">created_at</span> <span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #d14">'1998-10-05'</span> <span style="color: #000000;font-weight: bold">AND</span> <span style="background-color: #f8f8f8">created_at</span> <span style="color: #000000;font-weight: bold">&lt;</span> <span style="color: #d14">'2018-10-05'</span><span style="background-color: #f8f8f8">;</span>
</code></pre>
<p>Как и в случае с языками программирования, здесь действуют те же приоритеты. Чтобы не создавать неоднозначностей, в сложных ситуациях используются круглые скобки:</p>
<pre class="hljs"><code class=sql><span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span>
  <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">users</span>
  <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">first_name</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">'Sunny'</span> <span style="color: #000000;font-weight: bold">OR</span> <span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">created_at</span> <span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #d14">'2018-01-01'</span> <span style="color: #000000;font-weight: bold">AND</span> <span style="background-color: #f8f8f8">created_at</span> <span style="color: #000000;font-weight: bold">&lt;</span> <span style="color: #d14">'2018-10-05'</span><span style="background-color: #f8f8f8">);</span>
</code></pre><h2 id="between">BETWEEN</h2>
<p>Для условий диапазонов SQL поддерживает особый формат <code>BETWEEN</code>:</p>
<pre class="hljs"><code class=sql><span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span>
  <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">users</span>
  <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">created_at</span> <span style="color: #000000;font-weight: bold">BETWEEN</span> <span style="color: #d14">'2018-01-01'</span> <span style="color: #000000;font-weight: bold">AND</span> <span style="color: #d14">'2018-10-05'</span><span style="background-color: #f8f8f8">;</span>
<span style="color: #999988;font-style: italic">-- Идентично SELECT * FROM users WHERE created_at &gt;= '2018-01-01' AND created_at &lt;= '2018-10-05';</span>
</code></pre>
<p>Обратите внимание, что <code>BETWEEN</code> при сравнении <strong>включает</strong> границы диапазона.</p>
<h2 id="in">IN</h2>
<p>В некоторых ситуациях требуется найти не диапазон строк, а строки, в которых поле соответствует одному значению из набора. Предположим, что мы хотим найти пользователей с идентификаторами 1, 2 или 5, выполнив один запрос. Наиболее очевидный способ — использовать <code>OR</code>:</p>
<pre class="hljs"><code class=sql><span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span> <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">users</span> <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">id</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">1</span> <span style="color: #000000;font-weight: bold">OR</span> <span style="background-color: #f8f8f8">id</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">2</span> <span style="color: #000000;font-weight: bold">OR</span> <span style="background-color: #f8f8f8">id</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">5</span><span style="background-color: #f8f8f8">;</span>
</code></pre>
<p>Страшно представить, во что превратится запрос, если понадобится найти десяток совпадений. К счастью, SQL предлагает другое решение - <code>IN</code>:</p>
<pre class="hljs"><code class=sql><span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span> <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">users</span> <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">id</span> <span style="color: #000000;font-weight: bold">IN</span> <span style="background-color: #f8f8f8">(</span><span style="color: #009999">1</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">2</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">5</span><span style="background-color: #f8f8f8">);</span>
</code></pre>
<p>В ситуации, когда нужно исключить определённые записи, достаточно добавить <code>NOT</code>:</p>
<pre class="hljs"><code class=sql><span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span> <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">users</span> <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">id</span> <span style="color: #000000;font-weight: bold">NOT</span> <span style="color: #000000;font-weight: bold">IN</span> <span style="background-color: #f8f8f8">(</span><span style="color: #009999">1</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">2</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">5</span><span style="background-color: #f8f8f8">);</span>
</code></pre><h2 id="like">LIKE</h2>
<p>Иногда нужно искать по частичному совпадению: например, проверяя, что строка начинается или заканчивается с определённой последовательности символов. Допустим, мы хотим посмотреть пользователей, имя которых начинается с буквы <code>A</code>:</p>
<pre class="hljs"><code class=sql><span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span> <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">users</span> <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">first_name</span> <span style="color: #000000;font-weight: bold">LIKE</span> <span style="color: #d14">'A%'</span><span style="background-color: #f8f8f8">;</span>
</code></pre>
<p><code>%</code> — специальный заполнитель, который означает &quot;всё, что угодно&quot;. Если его поставить в конце, то поиск выполняется по совпадению в начале фразы, если в начале — то по совпадению с концом, а если в середине - то проверяется совпадение внутри текста. Совпадение в конце может понадобиться для анализа пользователей, зарегистрированных с определённого почтового домена:</p>
<pre class="hljs"><code class=sql><span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span> <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">users</span> <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">email</span> <span style="color: #000000;font-weight: bold">LIKE</span> <span style="color: #d14">'%hotmail.com'</span><span style="background-color: #f8f8f8">;</span>
</code></pre>
<p>Обратите внимание на то, что этот поиск <strong>регистрозависимый</strong>. Если вы хотите искать БЕЗ учёта регистра, то используйте <code>ILIKE</code>.</p>

<hr class='my-5'>
<h4 class='mb-4'>Дополнительные материалы</h4>
<ol>
<li class='lead'>
<a target="_blank" href="https://postgrespro.ru/docs/postgresql/11/sql-select">Официальная документация</a>
</li>
</ol>

</body>
</html>
