<!DOCTYPE html>
<html class='h-100' lang='ru' prefix='og: https://ogp.me/ns#'>

<head>
  <title>Первая нормальная форма - Основы реляционных баз данных</title>
  <meta content='width=device-width, initial-scale=1.0' name='viewport'>
  <meta charset='utf-8'>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>

<body class='h-100'>
  <div class='d-flex flex-column flex-md-row h-100'>
    <div class='x-border-md-right flex-fill tab-content overflow-hidden h-100'>
      <div aria-labelledby='lesson-tab' class='tab-pane fade show active overflow-auto h-100' id='lesson'
        role='tabpanel'>
        <div class='container-xl my-3 mb-md-4 mb-lg-5'>
          <div class='row justify-content-center'>
            <div class='col-12 col-lg-10'>
              <a class="small" data-toggle="collapse" href="theory_unit.html#tips">Ошибки, сложный материал, вопросы
                &gt;</a>
              <div class='collapse' id='tips'>
                <div class='py-3 px-4 x-line-height-15 bg-hexlet-gray mt-3'>
                  <h6 class='font-weight-bold'>Нашли опечатку или неточность?</h6>
                  <p>
                    Выделите текст, нажмите
                    <kbd class='bg-secondary'>ctrl + enter</kbd>
                    и отправьте его нам. В течение нескольких дней мы исправим ошибку или улучшим формулировку.
                  </p>
                  <h6 class='font-weight-bold'>Что-то не получается или материал кажется сложным?</h6>
                  <p class='mb-1'>Загляните в раздел «Обсуждение»:</p>
                  <ul>
                    <li>задайте вопрос. Вы быстрее справитесь с трудностями и прокачаете навык постановки правильных
                      вопросов, что пригодится и в учёбе, и в работе программистом;</li>
                    <li>расскажите о своих впечатлениях. Если курс слишком сложный, подробный отзыв поможет нам сделать
                      его лучше;</li>
                    <li>изучите вопросы других учеников и ответы на них. Это база знаний, которой можно и нужно
                      пользоваться.</li>
                  </ul>
                  <h6 class='font-weight-bold'>Об обучении на Хекслете</h6>
                  <ul class='list-unstyled mb-0'>
                    <li>
                      Статья «<a target="_blank" href="https://guides.hexlet.io/learning">Как учиться и справляться с
                        негативными мыслями</a>»
                    </li>
                    <li>
                      Статья «<a target="_blank" href="https://ru.hexlet.io/blog/posts/traps-learning">Ловушки
                        обучения</a>»
                    </li>
                    <li>
                      Статья «<a target="_blank"
                        href="https://ru.hexlet.io/blog/posts/slozhnye-prostye-zadachi-po-programmirovaniyu">Сложные
                        простые задачи по программированию</a>»
                    </li>
                    <li>
                      Урок «<a target="_blank"
                        href="https://ru.hexlet.io/courses/introduction_to_programming/lessons/hexlet-flow/theory_unit">Как
                        эффективно учиться на Хекслете</a>»
                    </li>
                    <li>
                      Вебинар «<a target="_blank" rel="noopener noreferrer nofollow"
                        href="https://www.youtube.com/watch?v=dCYZppVgGww">Как самостоятельно учиться</a>»
                    </li>
                  </ul>
                </div>
              </div>

              <div class='mt-3 paywall'>
                <div class='p-2 p-md-4 shadow-sm bg-white'>
                  <div class='hexlet-markdown-body overflow-hidden p-2 p-md-4'>
                    <a class="h6 mb-0 font-weight-normal text-muted x-link-only-hover"
                      href="../transactions/exercise_unit.html">Основы реляционных баз данных</a>
                    <h1 class='mt-0 mb-4'>Первая нормальная форма</h1>
                    <p>Возьмем для примера обычный интернет-магазин, в котором продается электроника. Каждый раз когда
                      пользователь делает заказ, в базу данных заносится запись об этом (в таблицу
                      <em>order_items</em>). В нее входит вся необходимая информация: какой товар купил пользователь,
                      сколько он стоил, адрес доставки и другое. Затем эти данные используются всеми подразделениями
                      интернет-магазина, начиная от бухгалтеров, заканчивая службой доставки.</p>

                    <p><strong>order_items</strong></p>

                    <table>
                      <thead>
                        <tr>
                          <th>first_name</th>
                          <th>last_name</th>
                          <th>address</th>
                          <th>item</th>
                          <th>price</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>Сергей</td>
                          <td>Иванов</td>
                          <td>Москва, ул. Промышленная</td>
                          <td>утюг</td>
                          <td>15.00</td>
                        </tr>
                        <tr>
                          <td>Иван</td>
                          <td>Петров</td>
                          <td>Самара, ул. Энгельса</td>
                          <td>кофеварка</td>
                          <td>5000.00</td>
                        </tr>
                        <tr>
                          <td>Виктор</td>
                          <td>Сидоров</td>
                          <td>Омск, ул. Дворцовая</td>
                          <td>утюг, телевизор</td>
                          <td>1000.00, 6500.00</td>
                        </tr>
                        <tr>
                          <td>Сергей</td>
                          <td>Иванов</td>
                          <td>Москва, ул. Матросова</td>
                          <td>ноутбук</td>
                          <td>20000.00</td>
                        </tr>
                        <tr>
                          <td>Сергей</td>
                          <td>Иванов</td>
                          <td>Москва, ул. Матросова</td>
                          <td>ноутбук</td>
                          <td>20000.00</td>
                        </tr>
                      </tbody>
                    </table>

                    <p>В последнем столбце, у первой строки цена указана в долларах, в остальных записях это рубли.
                      Последняя запись повторяет предыдущую, потому что этот заказ выполнил тот же человек, но сделал
                      это в другое время.</p>

                    <p>Невооруженным взглядом видно, что в этой табличке много повторяющейся информации. Попробуем
                      привести ее к правильной структуре с точки зрения реляционной модели. Для этого пройдемся по
                      нормальным формам.</p>

                    <p>Первая нормальная форма сводится к трем правилам:</p>

                    <ul>
                      <li>Каждая ячейка таблицы может хранить только одно значение</li>
                      <li>Все данные в одной колонке могут быть только одного типа</li>
                      <li>Каждая запись в таблице должна однозначно отличаться от других записей</li>
                    </ul>
                    <h2 id="kazhdaya-yacheyka-odno-znachenie">Каждая ячейка – одно значение</h2>
                    <p>В примере выше, у одной записи, поля <em>item</em> и <em>price</em> содержат два значения,
                      разделенных запятой. Такой способ организации данных имеет множество недостатков. Например
                      пропадает возможность делать обычную выборку по условиям:</p>
                    <pre class="hljs"><code class=sql><span style="color: #999988;font-style: italic">-- Как найти записи о всех проданных утюгах?</span>
<span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span> <span style="color: #000000;font-weight: bold">from</span> <span style="background-color: #f8f8f8">order_items</span> <span style="color: #000000;font-weight: bold">WHERE</span> <span style="background-color: #f8f8f8">item</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #008080">"?"</span>
</code></pre>
                    <p>Другая проблема связана с типами данных. Поле прайс в таблице <em>order_items</em> имеет числовой
                      тип (numeric). Если мы захотим хранить там более одного значения, то тип превратится в строковый,
                      а все данные станут обычными строками. При такой организации, невозможно проверить корректность
                      данных, формат числа. Становится крайне проблематично выполнить агрегирующие запросы, например,
                      посчитать выручку за определенный месяц одним запросом.</p>

                    <p>Избавиться от перечислений в ячейках можно через создание новых записей:</p>

                    <table>
                      <thead>
                        <tr>
                          <th>first_name</th>
                          <th>last_name</th>
                          <th>address</th>
                          <th>item</th>
                          <th>price</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>Сергей</td>
                          <td>Иванов</td>
                          <td>Москва, ул. Промышленная</td>
                          <td>утюг</td>
                          <td>15.00</td>
                        </tr>
                        <tr>
                          <td>Иван</td>
                          <td>Петров</td>
                          <td>Самара, ул. Энгельса</td>
                          <td>кофеварка</td>
                          <td>5000.00</td>
                        </tr>
                        <tr>
                          <td>Виктор</td>
                          <td>Сидоров</td>
                          <td>Омск, ул. Дворцовая</td>
                          <td>утюг</td>
                          <td>1000.00</td>
                        </tr>
                        <tr>
                          <td>Виктор</td>
                          <td>Сидоров</td>
                          <td>Омск, ул. Дворцовая</td>
                          <td>телевизор</td>
                          <td>6500.00</td>
                        </tr>
                        <tr>
                          <td>Сергей</td>
                          <td>Иванов</td>
                          <td>Москва, ул. Матросова</td>
                          <td>ноутбук</td>
                          <td>20000.00</td>
                        </tr>
                        <tr>
                          <td>Сергей</td>
                          <td>Иванов</td>
                          <td>Москва, ул. Матросова</td>
                          <td>ноутбук</td>
                          <td>20000.00</td>
                        </tr>
                      </tbody>
                    </table>
                    <h2 id="dannye-odnogo-tipa">Данные одного типа</h2>
                    <p>Верхняя запись в выводе выше, содержит цену указанную в долларах, хотя все остальные цены указаны
                      в рублях. Чисто технически, база никак не укажет на это. Что доллары, что рубли выше представлены
                      числами, но, с точки зрения программы, эти числа имеют совершенно разную природу.</p>

                    <p>Как и в предыдущем случае, разные данные в рамках одного поля делают невозможным выполнение
                      агрегирующих запросов (поиск сумм, максимального, минимального). Кроме того, усложняется обработка
                      данных на уровне кода. В коде придется каким-то образом понимать, что из себя представляют данные.
                    </p>

                    <p>Вот еще несколько примеров, с похожей ситуацией:</p>

                    <ul>
                      <li>Хранение даты свадьбы в поле &quot;день рождения&quot;</li>
                      <li>Хранение телефона вместо адреса в поле &quot;адрес&quot;</li>
                    </ul>

                    <p>Исправленная версия таблицы:</p>

                    <table>
                      <thead>
                        <tr>
                          <th>first_name</th>
                          <th>last_name</th>
                          <th>address</th>
                          <th>item</th>
                          <th>price</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>Сергей</td>
                          <td>Иванов</td>
                          <td>Москва, ул. Промышленная</td>
                          <td>утюг</td>
                          <td>1000.00</td>
                        </tr>
                        <tr>
                          <td>Иван</td>
                          <td>Петров</td>
                          <td>Самара, ул. Энгельса</td>
                          <td>кофеварка</td>
                          <td>5000.00</td>
                        </tr>
                        <tr>
                          <td>Виктор</td>
                          <td>Сидоров</td>
                          <td>Омск, ул. Дворцовая</td>
                          <td>утюг</td>
                          <td>1000.00</td>
                        </tr>
                        <tr>
                          <td>Виктор</td>
                          <td>Сидоров</td>
                          <td>Омск, ул. Дворцовая</td>
                          <td>телевизор</td>
                          <td>6500.00</td>
                        </tr>
                        <tr>
                          <td>Сергей</td>
                          <td>Иванов</td>
                          <td>Москва, ул. Матросова</td>
                          <td>ноутбук</td>
                          <td>20000.00</td>
                        </tr>
                        <tr>
                          <td>Сергей</td>
                          <td>Иванов</td>
                          <td>Москва, ул. Матросова</td>
                          <td>ноутбук</td>
                          <td>20000.00</td>
                        </tr>
                      </tbody>
                    </table>
                    <h2 id="unikalnye-zapisi">Уникальные записи</h2>
                    <p>Обратите внимание на последние две записи. Они выглядят идентично, хотя это два разных заказа
                      сделанных одним человеком в разное время. Вероятно он купил ноутбук сначала для себя, а потом для
                      супруги.</p>

                    <p>Реляционная модель требует от нас уникальности каждой записи. Для чего это нужно? Иначе
                      невозможно понять что к чему относится и с какой записью нужно работать при изменениях. Очень
                      легко начать править не то и потерять важную информацию. Причем мы даже не можем полагаться на
                      порядок данных внутри таблицы, ведь он не гарантирован.</p>

                    <p>Реализовать уникальность можно несколькими способами, например, добавить новых полей, которые
                      сделают запись уникальной, например дату заказа. Этот способ не очень надежный, а главное не очень
                      удобный в работе. Придется постоянно анализировать весь набор полей. Гораздо лучше добавить
                      <strong>первичный ключ</strong>.</p>

                    <p>Первичный ключ это поле или набор полей, которое содержит уникальное значение для каждой записи.
                      Первичный ключ не может меняться, его значение однозначно определяет любую запись в таблице.</p>

                    <p>В качестве первичного ключа можно использовать какое-то значение из окружающего мира, например
                      email или ФИО, но нужно однозначно убедиться что ключ не будет повторяться. Такой первичный ключ
                      называется <strong>естественным</strong>. Естественные ключи используют редко из-за их
                      ненадежности. Почти наверняка они не уникальны и могут изменяться или повторяться. Например, номер
                      паспорта меняется при смене паспорта.</p>

                    <p>Другой подход основан на использовании автоматически генерируемых уникальных значений. Такой
                      первичный ключ называется суррогатным и поддерживается любой базой данных &quot;из коробки&quot;.
                      Иногда это просто числа, а иногда и сложные число-буквенные строки (хеши). Добавим в нашу таблицу
                      первичный ключ:</p>

                    <table>
                      <thead>
                        <tr>
                          <th>id</th>
                          <th>first_name</th>
                          <th>last_name</th>
                          <th>address</th>
                          <th>item</th>
                          <th>price</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>8</td>
                          <td>Сергей</td>
                          <td>Иванов</td>
                          <td>Москва, ул. Промышленная</td>
                          <td>утюг</td>
                          <td>1000.00</td>
                        </tr>
                        <tr>
                          <td>2</td>
                          <td>Иван</td>
                          <td>Петров</td>
                          <td>Самара, ул. Энгельса</td>
                          <td>кофеварка</td>
                          <td>5000.00</td>
                        </tr>
                        <tr>
                          <td>7</td>
                          <td>Виктор</td>
                          <td>Сидоров</td>
                          <td>Омск, ул. Дворцовая</td>
                          <td>утюг</td>
                          <td>1000.00</td>
                        </tr>
                        <tr>
                          <td>4</td>
                          <td>Виктор</td>
                          <td>Сидоров</td>
                          <td>Омск, ул. Дворцовая</td>
                          <td>телевизор</td>
                          <td>6500.00</td>
                        </tr>
                        <tr>
                          <td>9</td>
                          <td>Сергей</td>
                          <td>Иванов</td>
                          <td>Москва, ул. Матросова</td>
                          <td>ноутбук</td>
                          <td>20000.00</td>
                        </tr>
                        <tr>
                          <td>6</td>
                          <td>Сергей</td>
                          <td>Иванов</td>
                          <td>Москва, ул. Матросова</td>
                          <td>ноутбук</td>
                          <td>20000.00</td>
                        </tr>
                      </tbody>
                    </table>

                    <p>Первичный ключ принято создавать первым полем с названием <em>id</em>. Для первичного ключа
                      обязательно указывать <em>PRIMARY KEY</em> в описании таблицы:</p>
                    <pre class="hljs"><code class=sql><span style="color: #999988;font-style: italic">-- Первичный ключ только один на таблицу</span>
<span style="color: #000000;font-weight: bold">CREATE</span> <span style="color: #000000;font-weight: bold">TABLE</span> <span style="background-color: #f8f8f8">products</span> <span style="background-color: #f8f8f8">(</span>
    <span style="background-color: #f8f8f8">id</span> <span style="color: #0086B3">bigint</span> <span style="color: #000000;font-weight: bold">PRIMARY</span> <span style="color: #000000;font-weight: bold">KEY</span><span style="background-color: #f8f8f8">,</span>
    <span style="background-color: #f8f8f8">first_name</span> <span style="color: #0086B3">varchar</span><span style="background-color: #f8f8f8">(</span><span style="color: #009999">255</span><span style="background-color: #f8f8f8">),</span>
    <span style="background-color: #f8f8f8">last_name</span> <span style="color: #0086B3">varchar</span><span style="background-color: #f8f8f8">(</span><span style="color: #009999">255</span><span style="background-color: #f8f8f8">),</span>
    <span style="background-color: #f8f8f8">address</span> <span style="color: #0086B3">varchar</span><span style="background-color: #f8f8f8">(</span><span style="color: #009999">255</span><span style="background-color: #f8f8f8">),</span>
    <span style="background-color: #f8f8f8">item</span> <span style="color: #0086B3">varchar</span><span style="background-color: #f8f8f8">(</span><span style="color: #009999">255</span><span style="background-color: #f8f8f8">),</span>
    <span style="background-color: #f8f8f8">price</span> <span style="color: #0086B3">numeric</span> <span style="color: #999988;font-style: italic">-- специальный тип данных, подходящий под работу с деньгами. Обеспечивает высокую точность при расчетах.</span>
<span style="background-color: #f8f8f8">);</span>
</code></pre>
                    <p>Такой ключ все еще нужно формировать самостоятельно (с автогенерацией мы познакомимся позже), но
                      теперь база данных сама следит за уникальностью. При попытке создать запись с повторяющимися
                      первичными ключами возникнет ошибка.</p>

                    <hr class='my-5'>
                    <h4 class='mb-4'>Дополнительные материалы</h4>
                    <ol>
                      <li class='lead'>
                        <a target="_blank"
                          href="https://ru.wikipedia.org/wiki/%D0%9F%D0%B5%D1%80%D0%B2%D0%B8%D1%87%D0%BD%D1%8B%D0%B9_%D0%BA%D0%BB%D1%8E%D1%87">Первичный
                          ключ</a>
                      </li>
                      <li class='lead'>
                        <a target="_blank"
                          href="https://ru.wikipedia.org/wiki/%D0%92%D0%BD%D0%B5%D1%88%D0%BD%D0%B8%D0%B9_%D0%BA%D0%BB%D1%8E%D1%87">Внешний
                          ключ</a>
                      </li>
                      <li class='lead'>
                        <a target="_blank"
                          href="https://ru.wikipedia.org/wiki/%D0%A1%D1%83%D1%80%D1%80%D0%BE%D0%B3%D0%B0%D1%82%D0%BD%D1%8B%D0%B9_%D0%BA%D0%BB%D1%8E%D1%87">Суррогатный
                          ключ</a>
                      </li>
                    </ol>

</body>

</html>