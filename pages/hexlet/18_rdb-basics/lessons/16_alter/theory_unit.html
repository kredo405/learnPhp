<!DOCTYPE html>
<html class='h-100' lang='ru' prefix='og: https://ogp.me/ns#'>

<head>
  <title>Изменение структуры таблицы (ALTER) - Основы реляционных баз...</title>
  <meta name="csrf-param" content="authenticity_token" />
  <meta name="csrf-token"
    content="82HxUVWPR8JViZKJMf3z1fzQ6EBVK-O7nottq05B8nYKvF86pqYa5Wd8wGTcVTBS4seJEUoJ6QzM2_c0hYCtfg" />
  <meta name="csp-nonce" />
  <link rel="shortcut icon" type="image/x-icon"
    href="https://cdn2.hexlet.io/assets/favicon-8fa102c058afb01de5016a155d7db433283dc7e08ddc3c4d1aef527c1b8502b6.ico" />
  <meta content='width=device-width, initial-scale=1.0' name='viewport'>
  <meta charset='utf-8'>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>

<body class='h-100'>
  <div class='d-flex flex-column flex-md-row h-100'>
    <div class='x-border-md-right flex-fill tab-content overflow-hidden h-100'>
      <div aria-labelledby='lesson-tab' class='tab-pane fade show active overflow-auto h-100' id='lesson'
        role='tabpanel'>
        <div class='container-xl my-3 mb-md-4 mb-lg-5'>
          <div class='row justify-content-center'>
            <div class='col-12 col-lg-10'>
              <a class="small" data-toggle="collapse" href="theory_unit.html#tips">Ошибки, сложный материал, вопросы
                &gt;</a>
              <div class='collapse' id='tips'>
                <div class='py-3 px-4 x-line-height-15 bg-hexlet-gray mt-3'>
                  <h6 class='font-weight-bold'>Нашли опечатку или неточность?</h6>
                  <p>
                    Выделите текст, нажмите
                    <kbd class='bg-secondary'>ctrl + enter</kbd>
                    и отправьте его нам. В течение нескольких дней мы исправим ошибку или улучшим формулировку.
                  </p>
                  <h6 class='font-weight-bold'>Что-то не получается или материал кажется сложным?</h6>
                  <p class='mb-1'>Загляните в раздел «Обсуждение»:</p>
                  <ul>
                    <li>задайте вопрос. Вы быстрее справитесь с трудностями и прокачаете навык постановки правильных
                      вопросов, что пригодится и в учёбе, и в работе программистом;</li>
                    <li>расскажите о своих впечатлениях. Если курс слишком сложный, подробный отзыв поможет нам сделать
                      его лучше;</li>
                    <li>изучите вопросы других учеников и ответы на них. Это база знаний, которой можно и нужно
                      пользоваться.</li>
                  </ul>
                  <h6 class='font-weight-bold'>Об обучении на Хекслете</h6>
                  <ul class='list-unstyled mb-0'>
                    <li>
                      Статья «<a target="_blank" href="https://guides.hexlet.io/learning">Как учиться и справляться с
                        негативными мыслями</a>»
                    </li>
                    <li>
                      Статья «<a target="_blank" href="https://ru.hexlet.io/blog/posts/traps-learning">Ловушки
                        обучения</a>»
                    </li>
                    <li>
                      Статья «<a target="_blank"
                        href="https://ru.hexlet.io/blog/posts/slozhnye-prostye-zadachi-po-programmirovaniyu">Сложные
                        простые задачи по программированию</a>»
                    </li>
                    <li>
                      Урок «<a target="_blank"
                        href="https://ru.hexlet.io/courses/introduction_to_programming/lessons/hexlet-flow/theory_unit">Как
                        эффективно учиться на Хекслете</a>»
                    </li>
                    <li>
                      Вебинар «<a target="_blank" rel="noopener noreferrer nofollow"
                        href="https://www.youtube.com/watch?v=dCYZppVgGww">Как самостоятельно учиться</a>»
                    </li>
                  </ul>
                </div>
              </div>

              <div class='mt-3 paywall'>
                <div class='p-2 p-md-4 shadow-sm bg-white'>
                  <div class='hexlet-markdown-body overflow-hidden p-2 p-md-4'>
                    <a class="h6 mb-0 font-weight-normal text-muted x-link-only-hover"
                      href="../transactions/exercise_unit.html">Основы реляционных баз данных</a>
                    <h1 class='mt-0 mb-4'>Изменение структуры таблицы (ALTER)</h1>
                    <p>Наиболее сложный запрос при работе с таблицами — обновление <strong>структуры</strong> таблицы.
                      Если посмотреть официальную документацию, то общая запись этого запроса занимает больше трёх
                      экранов монитора! Хочу сразу вас успокоить, думаю ни один человек на свете не помнит всех
                      возможностей этой команды. Более того, большинство из них настолько редко выполняются, что
                      программисты каждый раз лезут в гугл и вспоминают синтаксис. Единственное, что нужно знать —
                      возможности этой команды (общие принципы её работы), а детали всегда можно будет найти в
                      документации.</p>

                    <p>Этот тип запроса называется <code>ALTER</code> и включает в себя четыре разных операции со
                      столбцами:</p>
                    <h3 id="dobavlenie-kolonki">Добавление колонки</h3>
                    <p><img alt="Добавление поля в таблицу" class="lazyload px-2 px-md-3 px-lg-4 px-xl-5"
                        data-src="https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6IjRiZTIwYTM3ZDIyMDMzZGQxNmYyMzU5NDYwM2Q0NjA0LmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=535eb9dc811700f7ea3781b0961cb0e9273745eab8e0b75cdcbcdd8ea4ec815c"
                        src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" /></p>
                    <pre class="hljs"><code class=sql><span style="color: #999988;font-style: italic">-- в таблице "courses"</span>
<span style="color: #999988;font-style: italic">-- добавить колонку с именем "example1" и типом "timestamp"</span>
<span style="color: #000000;font-weight: bold">ALTER</span> <span style="color: #000000;font-weight: bold">TABLE</span> <span style="background-color: #f8f8f8">courses</span> <span style="color: #000000;font-weight: bold">ADD</span> <span style="color: #000000;font-weight: bold">COLUMN</span> <span style="background-color: #f8f8f8">example1</span> <span style="color: #0086B3">timestamp</span><span style="background-color: #f8f8f8">;</span>
</code></pre>
                    <p>Здесь после фразы <code>ADD COLUMN</code> идёт строка описания новой колонки, точно такая же, как
                      и при создании таблицы. В простейшем случае она выглядит так:
                      <code>&lt;имя колонки&gt; &lt;тип&gt;</code>. Здесь можно указывать любые ограничения, добавлять
                      ключи, автогенерацию, значение по умолчанию и многое другое. Самое приятное, что синтаксис на 100%
                      совпадает с синтаксисом определения колонки при создании таблицы.</p>
                    <h3 id="pereimenovanie-kolonki">Переименование колонки</h3>
                    <pre class="hljs"><code class=sql><span style="color: #999988;font-style: italic">-- в таблице "courses"</span>
<span style="color: #999988;font-style: italic">-- изменить колонку "example1":</span>
<span style="color: #999988;font-style: italic">-- поменять имя с "example1" на "example2"</span>
<span style="color: #000000;font-weight: bold">ALTER</span> <span style="color: #000000;font-weight: bold">TABLE</span> <span style="background-color: #f8f8f8">courses</span> <span style="color: #000000;font-weight: bold">RENAME</span> <span style="color: #000000;font-weight: bold">COLUMN</span> <span style="background-color: #f8f8f8">example1</span> <span style="color: #000000;font-weight: bold">TO</span> <span style="background-color: #f8f8f8">example2</span><span style="background-color: #f8f8f8">;</span>
</code></pre>
                    <p>Простая операция, в которой нет никаких сюрпризов. Одно имя меняется на другое.</p>
                    <h3 id="udalenie-kolonki">Удаление колонки</h3>
                    <pre class="hljs"><code class=sql><span style="color: #999988;font-style: italic">-- в таблице "courses"</span>
<span style="color: #999988;font-style: italic">-- удалить колонку с именем "example2"</span>
<span style="color: #000000;font-weight: bold">ALTER</span> <span style="color: #000000;font-weight: bold">TABLE</span> <span style="background-color: #f8f8f8">courses</span> <span style="color: #000000;font-weight: bold">DROP</span> <span style="color: #000000;font-weight: bold">COLUMN</span> <span style="background-color: #f8f8f8">example2</span><span style="background-color: #f8f8f8">;</span>
</code></pre>
                    <p>Тоже простая операция: удаление — оно и в Африке удаление ;)</p>
                    <h3 id="obnovlenie-kolonki">Обновление колонки</h3>
                    <p>Команда по изменению параметров колонки наиболее сложная. Практически каждый элемент, который
                      поддаётся обновлению, имеет собственный синтаксис для этого обновления. Вот пара базовых примеров:
                    </p>
                    <pre class="hljs"><code class=sql><span style="color: #000000;font-weight: bold">ALTER</span> <span style="color: #000000;font-weight: bold">TABLE</span> <span style="background-color: #f8f8f8">addresses</span>
    <span style="color: #000000;font-weight: bold">ADD</span> <span style="color: #000000;font-weight: bold">PRIMARY</span> <span style="color: #000000;font-weight: bold">KEY</span> <span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">id</span><span style="background-color: #f8f8f8">);</span>

<span style="color: #000000;font-weight: bold">ALTER</span> <span style="color: #000000;font-weight: bold">TABLE</span> <span style="background-color: #f8f8f8">addresses</span>
    <span style="color: #000000;font-weight: bold">ALTER</span> <span style="color: #000000;font-weight: bold">COLUMN</span> <span style="background-color: #f8f8f8">created_at</span> <span style="color: #000000;font-weight: bold">SET</span> <span style="color: #000000;font-weight: bold">DATA</span> <span style="color: #000000;font-weight: bold">TYPE</span> <span style="color: #0086B3">timestamp</span><span style="background-color: #f8f8f8">,</span>
    <span style="color: #000000;font-weight: bold">ALTER</span> <span style="color: #000000;font-weight: bold">COLUMN</span> <span style="background-color: #f8f8f8">street</span> <span style="color: #000000;font-weight: bold">DROP</span> <span style="color: #000000;font-weight: bold">NOT</span> <span style="color: #000000;font-weight: bold">NULL</span><span style="background-color: #f8f8f8">;</span>

<span style="color: #999988;font-style: italic">-- Добавление уникального индекса в таблицу "products" для колонки "product_id" </span>
<span style="color: #000000;font-weight: bold">ALTER</span> <span style="color: #000000;font-weight: bold">TABLE</span> <span style="background-color: #f8f8f8">products</span> <span style="color: #000000;font-weight: bold">ADD</span> <span style="color: #000000;font-weight: bold">UNIQUE</span> <span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">product_id</span><span style="background-color: #f8f8f8">);</span>
</code></pre>
                    <p>Наиболее распространённые команды:</p>

                    <ul>
                      <li><code>ADD</code> — добавление ограничения: например, ключа или уникальности</li>
                      <li><code>SET</code> — установка значения: например, типа данных</li>
                      <li><code>DROP</code> — удаление ограничения</li>
                    </ul>

                    <p>Запрос <em>ALTER</em> устроен таким образом, что в рамках одного обновления можно группировать
                      только одинаковые операции. В примере выше как раз это показано: один запрос добавляет первичный
                      ключ, а другой обновляет сразу два поля. Если попробовать объединить их в один <em>ALTER</em>, то
                      СУБД завершит запрос с ошибкой.</p>
                    <h2 id="na-praktike">На практике</h2>
                    <p>Стоит сказать, что операции по переименованию или удалению колонок не являются безопасными.
                      Удаление колонки в работающей базе данных, приведет к ошибкам во время вставки или обновления
                      записей. Любые выборки включающие эту колонку, также завершатся с ошибкой.</p>

                    <p>Поэтому такие операции выполняют редко и только тогда, когда есть уверенность, что эти колонки
                      никто не использует. Кроме того, обновление колонки может серьёзно влиять на производительность и,
                      в некоторых ситуациях (если данных много) — выполняться продолжительное (многие часы и даже дни!)
                      время.</p>

                    <p>Обновление структуры базы данных — очень серьёзная история, которой посвящена не одна книга.</p>

                    <hr class='my-5'>
                    <h4 class='mb-4'>Дополнительные материалы</h4>
                    <ol>
                      <li class='lead'>
                        <a target="_blank" href="https://postgrespro.ru/docs/postgresql/11/ddl-alter">Официальная
                          документация</a>
                      </li>
                      <li class='lead'>
                        <a target="_blank" href="https://www.ozon.ru/context/detail/id/3261793/">Рефакторинг баз данных.
                          Эволюционное проектирование</a>
                      </li>
                    </ol>

</body>

</html>