<!DOCTYPE html>
<html class='h-100' lang='ru' prefix='og: https://ogp.me/ns#'>

<head>
  <title>Фильтрация (filter) - PHP: Функции</title>
  <meta content='width=device-width, initial-scale=1.0' name='viewport'>
  <meta charset='utf-8'>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>

<body class='h-100'>
  <div class='d-flex flex-column flex-md-row h-100'>
    <div class='x-border-md-right flex-fill tab-content overflow-hidden h-100'>
      <div aria-labelledby='lesson-tab' class='tab-pane fade show active overflow-auto h-100' id='lesson'
        role='tabpanel'>
        <div class='container-xl my-3 mb-md-4 mb-lg-5'>
          <div class='row justify-content-center'>
            <div class='col-12 col-lg-10'>
              <div class='mt-3 paywall'>
                <div class='p-2 p-md-4 shadow-sm bg-white'>
                  <div class='hexlet-markdown-body overflow-hidden p-2 p-md-4'>
                    <h1 class='mt-0 mb-4'>Фильтрация (filter)</h1>
                    <p>Следующая операция называется &quot;фильтрация&quot; и выполняется она в PHP с помощью функции
                      <code>array_filter</code> (в других языках её называют просто <code>filter</code> или
                      <code>select</code>). Понятие &quot;фильтрация&quot; интуитивно понятно каждому человеку. Мы пьём
                      фильтрованную воду и фильтруем то, что говорим. В программировании практически то же самое.
                      Операция &quot;фильтрация&quot; по отношению к коллекции означает, что мы отбираем из неё только
                      те элементы, которые удовлетворяют условию. Возьмём наших многострадальных пользователей. Типичная
                      задача может выглядеть так, выберем пользователей старше 10 лет.</p>
                    <pre class="hljs"><code class=php><span style="color: #999999;font-weight: bold">&lt;?php</span>

<span style="color: #008080">$users</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">[</span>
    <span style="background-color: #f8f8f8">[</span><span style="color: #d14">'name'</span> <span style="color: #000000;font-weight: bold">=&gt;</span> <span style="color: #d14">'Igor'</span><span style="background-color: #f8f8f8">,</span> <span style="color: #d14">'age'</span> <span style="color: #000000;font-weight: bold">=&gt;</span> <span style="color: #009999">19</span><span style="background-color: #f8f8f8">],</span>
    <span style="background-color: #f8f8f8">[</span><span style="color: #d14">'name'</span> <span style="color: #000000;font-weight: bold">=&gt;</span> <span style="color: #d14">'Danil'</span><span style="background-color: #f8f8f8">,</span> <span style="color: #d14">'age'</span> <span style="color: #000000;font-weight: bold">=&gt;</span> <span style="color: #009999">1</span><span style="background-color: #f8f8f8">],</span>
    <span style="background-color: #f8f8f8">[</span><span style="color: #d14">'name'</span> <span style="color: #000000;font-weight: bold">=&gt;</span> <span style="color: #d14">'Vovan'</span><span style="background-color: #f8f8f8">,</span> <span style="color: #d14">'age'</span> <span style="color: #000000;font-weight: bold">=&gt;</span> <span style="color: #009999">4</span><span style="background-color: #f8f8f8">],</span>
    <span style="background-color: #f8f8f8">[</span><span style="color: #d14">'name'</span> <span style="color: #000000;font-weight: bold">=&gt;</span> <span style="color: #d14">'Matvey'</span><span style="background-color: #f8f8f8">,</span> <span style="color: #d14">'age'</span> <span style="color: #000000;font-weight: bold">=&gt;</span> <span style="color: #009999">16</span><span style="background-color: #f8f8f8">],</span>
<span style="background-color: #f8f8f8">];</span>

<span style="color: #008080">$result</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">[];</span>
<span style="color: #000000;font-weight: bold">foreach</span> <span style="background-color: #f8f8f8">(</span><span style="color: #008080">$users</span> <span style="color: #000000;font-weight: bold">as</span> <span style="color: #008080">$user</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #000000;font-weight: bold">if</span> <span style="background-color: #f8f8f8">(</span><span style="color: #008080">$user</span><span style="background-color: #f8f8f8">[</span><span style="color: #d14">'age'</span><span style="background-color: #f8f8f8">]</span> <span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #009999">10</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #008080">$result</span><span style="background-color: #f8f8f8">[]</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #008080">$user</span><span style="background-color: #f8f8f8">;</span>
    <span style="background-color: #f8f8f8">}</span>
<span style="background-color: #f8f8f8">}</span>
<span style="color: #0086B3">print_r</span><span style="background-color: #f8f8f8">(</span><span style="color: #008080">$result</span><span style="background-color: #f8f8f8">);</span>
<span style="color: #999988;font-style: italic">// =&gt; Array</span>
<span style="color: #999988;font-style: italic">// (</span>
<span style="color: #999988;font-style: italic">//     [0] =&gt; Array</span>
<span style="color: #999988;font-style: italic">//         (</span>
<span style="color: #999988;font-style: italic">//             [name] =&gt; Igor</span>
<span style="color: #999988;font-style: italic">//             [age] =&gt; 19</span>
<span style="color: #999988;font-style: italic">//         )</span>
<span style="color: #999988;font-style: italic">//</span>
<span style="color: #999988;font-style: italic">//     [1] =&gt; Array</span>
<span style="color: #999988;font-style: italic">//         (</span>
<span style="color: #999988;font-style: italic">//             [name] =&gt; Matvey</span>
<span style="color: #999988;font-style: italic">//             [age] =&gt; 16</span>
<span style="color: #999988;font-style: italic">//         )</span>
<span style="color: #999988;font-style: italic">//</span>
<span style="color: #999988;font-style: italic">// )</span>
</code></pre>
                    <p>Фильтрация встречается так же часто как отображение, а возможно и чаще. Общая схема кода при
                      фильтрации практически один в один как и в отображении, кроме пары ключевых моментов:</p>

                    <ul>
                      <li>Фильтрация возвращает коллекцию либо того же размера (если ничего не было отфильтровано), либо
                        меньшего. Она может вернуть даже пустую коллекцию, если ни один из элементов не подошёл.</li>
                      <li>Фильтрация всегда возвращает исходные элементы. Она никогда не делает отображение. Если на
                        вход фильтрации поступил список пользователей, то список пользователей будет и на выходе.</li>
                    </ul>

                    <p>Теперь посмотрим, как выглядит фильтрация при использовании функции высшего порядка
                      <code>array_filter</code>.</p>
                    <pre class="hljs"><code class=php><span style="color: #999999;font-weight: bold">&lt;?php</span>

<span style="color: #999988;font-style: italic">// Порядок аргументов обратный. Сначала коллекция, затем функция.</span>
<span style="color: #999988;font-style: italic">// $user – элемент массива $users </span>
<span style="color: #008080">$filteredUsers</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #0086B3">array_filter</span><span style="background-color: #f8f8f8">(</span><span style="color: #008080">$users</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">fn</span><span style="background-color: #f8f8f8">(</span><span style="color: #008080">$user</span><span style="background-color: #f8f8f8">)</span> <span style="color: #000000;font-weight: bold">=&gt;</span> <span style="color: #008080">$user</span><span style="background-color: #f8f8f8">[</span><span style="color: #d14">'age'</span><span style="background-color: #f8f8f8">]</span> <span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #009999">10</span><span style="background-color: #f8f8f8">);</span>
</code></pre>
                    <p>В отличие от <code>array_map</code>, функция, которая передаётся в <code>array_filter</code>
                      должна быть предикатом. То есть её задача вернуть либо <code>true</code> либо <code>false</code>
                      для каждого элемента коллекции. Значение, которое возвращается никак не используется, оно всего
                      лишь говорит о том, включать ли текущий элемент в итоговый массив либо нет. Новички часто делают
                      ошибку на этом этапе и начинают возвращать из фильтра то, что они бы хотели увидеть в
                      результирующем массиве (для этого надо применять <code>array_map</code>).</p>
                    <h2 id="realizatsiya">Реализация</h2>
                    <pre class="hljs"><code class=php><span style="color: #999999;font-weight: bold">&lt;?php</span>

<span style="color: #000000;font-weight: bold">function</span> <span style="background-color: #f8f8f8">myFilter</span><span style="background-color: #f8f8f8">(</span><span style="color: #008080">$coll</span><span style="background-color: #f8f8f8">,</span> <span style="color: #445588;font-weight: bold">callable</span> <span style="color: #008080">$callback</span><span style="background-color: #f8f8f8">)</span>
<span style="background-color: #f8f8f8">{</span>
    <span style="color: #008080">$result</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">[];</span>
    <span style="color: #000000;font-weight: bold">foreach</span> <span style="background-color: #f8f8f8">(</span><span style="color: #008080">$coll</span> <span style="color: #000000;font-weight: bold">as</span> <span style="color: #008080">$key</span> <span style="color: #000000;font-weight: bold">=&gt;</span> <span style="color: #008080">$item</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #999988;font-style: italic">// Предикат используется только для проверки</span>
        <span style="color: #999988;font-style: italic">// Внутрь $callback по очереди передается каждый элемент коллекции $coll</span>
        <span style="color: #000000;font-weight: bold">if</span> <span style="background-color: #f8f8f8">(</span><span style="color: #008080">$callback</span><span style="background-color: #f8f8f8">(</span><span style="color: #008080">$item</span><span style="background-color: #f8f8f8">))</span> <span style="background-color: #f8f8f8">{</span>
            <span style="color: #999988;font-style: italic">// В результат всегда добавляется элемент исходной коллекции</span>
            <span style="color: #008080">$result</span><span style="background-color: #f8f8f8">[</span><span style="color: #008080">$key</span><span style="background-color: #f8f8f8">]</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #008080">$item</span><span style="background-color: #f8f8f8">;</span>
        <span style="background-color: #f8f8f8">}</span>
    <span style="background-color: #f8f8f8">}</span>
    <span style="color: #000000;font-weight: bold">return</span> <span style="color: #008080">$result</span><span style="background-color: #f8f8f8">;</span>
<span style="background-color: #f8f8f8">}</span>
</code></pre>
                    <p>Обратите внимание на то, что <code>array_filter</code> сохраняет ключи. При работе с
                      индексированными массивами такое поведение нежелательно, поэтому придётся использовать функцию
                      <code>array_values</code> для сброса порядка.</p>

                      <div class="d-flex justify-content-center">
                        <a href="./exercise_unit.html" type="button" class="btn btn-dark">Задача</a>
                      </div>

</body>

</html>