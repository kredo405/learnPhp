<!DOCTYPE html>
<html class='h-100' lang='ru' prefix='og: https://ogp.me/ns#'>

<head>
  <title>DS - PHP: Объектно-ориентированный дизайн</title>
  <meta content='width=device-width, initial-scale=1.0' name='viewport'>
  <meta charset='utf-8'>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>

<body class='h-100'>
  <div class='d-flex flex-column flex-md-row h-100'>
    <div class='x-border-md-right flex-fill tab-content overflow-hidden h-100'>
      <div aria-labelledby='lesson-tab' class='tab-pane fade show active overflow-auto h-100' id='lesson'
        role='tabpanel'>
        <div class='container-xl my-3 mb-md-4 mb-lg-5'>
          <div class='row justify-content-center'>
            <div class='col-12 col-lg-10'>
              <div class='mt-3 paywall'>
                <div class='p-2 p-md-4 shadow-sm bg-white'>
                  <div class='hexlet-markdown-body overflow-hidden p-2 p-md-4'>
                    <h1 class='mt-0 mb-4'>DS</h1>
                    <p>PHP поставляется с библиотекой, называемой <a href="https://www.php.net/manual/ru/book.spl.php"
                        target="_blank" rel="nofollow">SPL</a> (Standard PHP Library). Кроме прочего, она содержит <a
                        href="https://www.php.net/manual/ru/spl.datastructures.php" target="_blank" rel="nofollow">набор
                        классов</a>, реализующих популярные структуры данных, такие как стек или очередь.</p>
                    <pre class="hljs"><code class=php><span style="color: #999999;font-weight: bold">&lt;?php</span>

<span style="color: #008080">$q</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">SplStack</span><span style="background-color: #f8f8f8">();</span>
<span style="color: #008080">$q</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="color: #990000;font-weight: bold">push</span><span style="background-color: #f8f8f8">(</span><span style="color: #009999">3</span><span style="background-color: #f8f8f8">);</span>
<span style="color: #008080">$q</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="color: #990000;font-weight: bold">push</span><span style="background-color: #f8f8f8">(</span><span style="color: #009999">10</span><span style="background-color: #f8f8f8">);</span>
<span style="color: #008080">$q</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="color: #990000;font-weight: bold">pop</span><span style="background-color: #f8f8f8">();</span> <span style="color: #999988;font-style: italic">// 10</span>
<span style="color: #008080">$q</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="color: #990000;font-weight: bold">pop</span><span style="background-color: #f8f8f8">();</span> <span style="color: #999988;font-style: italic">// 3</span>
</code></pre>
                    <p>Несмотря на то, что SPL встроен в язык, конкретно к структурам данных есть множество претензий со
                      стороны сообщества, как по производительности, так и по интерфейсам классов. Всё это вылилось в
                      создание расширения php-ds (DS). Подробнее о нем читайте в статье <a
                        href="https://medium.com/@rtheunissen/efficient-data-structures-for-php-7-9dda7af674cd"
                        target="_blank">https://medium.com/@rtheunissen/efficient-data-structures-for-php-7-9dda7af674cd</a>.
                      php-ds можно установить как обычный пакет <a href="https://github.com/php-ds/polyfill"
                        target="_blank">https://github.com/php-ds/polyfill</a>. Вся документация доступна здесь: <a
                        href="https://php.net/manual/ru/book.ds.php"
                        target="_blank">https://php.net/manual/ru/book.ds.php</a>.</p>

                    <p>DS включает в себя Vector, Deque, Map, Set, Stack, Queue, PriorityQueue, Pair. Эти структуры в
                      жизни обычного веб-разработчика нужны не каждый день, но всё же такое случается. Если вы с ними не
                      знакомы, то имеет смысл хотя бы прочитать о них в википедии.</p>
                    <h2 id="stack">Stack</h2>
                    <p>Стек — это коллекция типа &quot;Последний вошёл, первый вышел&quot; (Last In, First Out или
                      LIFO), которая позволяет работать только с самым верхним (последним) значением. Итерация
                      происходит от конца к началу с удалением взятого элемента.</p>
                    <pre class="hljs"><code class=php><span style="color: #999999;font-weight: bold">&lt;?php</span>

<span style="color: #008080">$stack</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #a61717;background-color: #e3d2d2">\</span><span style="color: #990000;font-weight: bold">Ds\Stack</span><span style="background-color: #f8f8f8">();</span>
<span style="color: #008080">$stack</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="color: #990000;font-weight: bold">push</span><span style="background-color: #f8f8f8">(</span><span style="color: #009999">3</span><span style="background-color: #f8f8f8">);</span>
<span style="color: #008080">$stack</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="color: #990000;font-weight: bold">push</span><span style="background-color: #f8f8f8">(</span><span style="color: #009999">10</span><span style="background-color: #f8f8f8">);</span>
<span style="color: #008080">$stack</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="color: #990000;font-weight: bold">pop</span><span style="background-color: #f8f8f8">();</span> <span style="color: #999988;font-style: italic">// 10</span>
<span style="color: #008080">$stack</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="color: #990000;font-weight: bold">pop</span><span style="background-color: #f8f8f8">();</span> <span style="color: #999988;font-style: italic">// 3</span>
<span style="color: #0086B3">print_r</span><span style="background-color: #f8f8f8">(</span><span style="color: #008080">$stack</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="color: #990000;font-weight: bold">toArray</span><span style="background-color: #f8f8f8">());</span>
</code></pre>
                    <p>Методы <code>pop()</code> и <code>push()</code> составляют основной интерфейс класса.
                      <code>push()</code> добавляет элемент (или элементы) на стек, <code>pop()</code> - снимает со
                      стека.</p>

                    <p>Перепишем с использованием этого стека функцию, которая разбиралась в курсе &quot;PHP:
                      массивы&quot;. Напомню задачу:</p>

                    <p>Необходимо реализовать функцию, которая проверяет, что парные символы сбалансированы. То есть
                      каждый открывающий символ имеет закрывающий, и они не перекрываются, например, так:
                      <code>[{]}</code>. К таким символам в нашем случае относятся <code>&lt;&gt;, {}, (), []</code>.
                      Входом в функцию может быть <code>()&lt;&gt;{}</code>. Такой пример проходит проверку, а вот этот
                      уже нет: <code>[({)}]</code>. Здесь происходит перекрытие фигурных и круглых скобок.</p>
                    <pre class="hljs"><code class=php><span style="color: #999999;font-weight: bold">&lt;?php</span>

<span style="color: #000000;font-weight: bold">function</span> <span style="background-color: #f8f8f8">checkIfBalanced</span><span style="background-color: #f8f8f8">(</span><span style="color: #445588;font-weight: bold">string</span> <span style="color: #008080">$expression</span><span style="background-color: #f8f8f8">):</span> <span style="color: #445588;font-weight: bold">boolean</span>
<span style="background-color: #f8f8f8">{</span>
    <span style="color: #999988;font-style: italic">// инициализируем стек</span>
    <span style="color: #008080">$stack</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #a61717;background-color: #e3d2d2">\</span><span style="color: #990000;font-weight: bold">Ds\Stack</span><span style="background-color: #f8f8f8">();</span>
    <span style="color: #999988;font-style: italic">// инициализируем список открывающих элементов</span>
    <span style="color: #008080">$startSymbols</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">[</span><span style="color: #d14">'{'</span><span style="background-color: #f8f8f8">,</span> <span style="color: #d14">'('</span><span style="background-color: #f8f8f8">,</span> <span style="color: #d14">'&lt;'</span><span style="background-color: #f8f8f8">,</span> <span style="color: #d14">'['</span><span style="background-color: #f8f8f8">];</span>
    <span style="color: #999988;font-style: italic">// инициализируем список пар</span>
    <span style="color: #008080">$pairs</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">[</span><span style="color: #d14">'{}'</span><span style="background-color: #f8f8f8">,</span> <span style="color: #d14">'()'</span><span style="background-color: #f8f8f8">,</span> <span style="color: #d14">'&lt;&gt;'</span><span style="background-color: #f8f8f8">,</span> <span style="color: #d14">'[]'</span><span style="background-color: #f8f8f8">];</span>

    <span style="color: #999988;font-style: italic">// Проходим по строке от первого до последнего символа</span>
    <span style="color: #000000;font-weight: bold">for</span> <span style="background-color: #f8f8f8">(</span><span style="color: #008080">$i</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">0</span><span style="background-color: #f8f8f8">;</span> <span style="color: #008080">$i</span> <span style="color: #000000;font-weight: bold">&lt;</span> <span style="color: #0086B3">strlen</span><span style="background-color: #f8f8f8">(</span><span style="color: #008080">$expression</span><span style="background-color: #f8f8f8">);</span> <span style="color: #008080">$i</span><span style="color: #000000;font-weight: bold">++</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #008080">$curr</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #008080">$expression</span><span style="background-color: #f8f8f8">[</span><span style="color: #008080">$i</span><span style="background-color: #f8f8f8">];</span>
        <span style="color: #999988;font-style: italic">// Если текущий символ находится в списке открывающих символов, то заносим его в стек</span>
        <span style="color: #000000;font-weight: bold">if</span> <span style="background-color: #f8f8f8">(</span><span style="color: #0086B3">in_array</span><span style="background-color: #f8f8f8">(</span><span style="color: #008080">$curr</span><span style="background-color: #f8f8f8">,</span> <span style="color: #008080">$startSymbols</span><span style="background-color: #f8f8f8">))</span> <span style="background-color: #f8f8f8">{</span>
            <span style="color: #008080">$stack</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="color: #990000;font-weight: bold">push</span><span style="background-color: #f8f8f8">(</span><span style="color: #008080">$curr</span><span style="background-color: #f8f8f8">);</span>
        <span style="background-color: #f8f8f8">}</span> <span style="color: #000000;font-weight: bold">else</span> <span style="background-color: #f8f8f8">{</span> <span style="color: #999988;font-style: italic">// Если элемент не входит в список открывающих, то считаем, что это закрывающий символ</span>
            <span style="color: #008080">$prev</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #008080">$stack</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="color: #990000;font-weight: bold">pop</span><span style="background-color: #f8f8f8">();</span>
            <span style="color: #999988;font-style: italic">// Составляем из этих символов пару</span>
            <span style="color: #008080">$pair</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">"</span><span style="color: #d14">{</span><span style="color: #008080">$prev</span><span style="color: #d14">}{</span><span style="color: #008080">$curr</span><span style="color: #d14">}</span><span style="color: #d14">"</span><span style="background-color: #f8f8f8">;</span>
            <span style="color: #999988;font-style: italic">// Проверяем, что она входит в список $pairs. Если входит, то все правильно, двигаемся дальше; если нет,</span>
            <span style="color: #999988;font-style: italic">// то это автоматически означает, что символы не сбалансированы</span>
            <span style="color: #000000;font-weight: bold">if</span> <span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">!</span><span style="color: #0086B3">in_array</span><span style="background-color: #f8f8f8">(</span><span style="color: #008080">$pair</span><span style="background-color: #f8f8f8">,</span> <span style="color: #008080">$pairs</span><span style="background-color: #f8f8f8">))</span> <span style="background-color: #f8f8f8">{</span>
                <span style="color: #000000;font-weight: bold">return</span> <span style="color: #000000;font-weight: bold">false</span><span style="background-color: #f8f8f8">;</span>
            <span style="background-color: #f8f8f8">}</span>
        <span style="background-color: #f8f8f8">};</span>
    <span style="background-color: #f8f8f8">}</span>

    <span style="color: #999988;font-style: italic">// Если стек оказался пустым после обхода строки, то значит все хорошо</span>
    <span style="color: #000000;font-weight: bold">return</span> <span style="color: #0086B3">sizeof</span><span style="background-color: #f8f8f8">(</span><span style="color: #008080">$stack</span><span style="background-color: #f8f8f8">)</span> <span style="color: #000000;font-weight: bold">===</span> <span style="color: #009999">0</span><span style="background-color: #f8f8f8">;</span>
<span style="background-color: #f8f8f8">}</span>
</code></pre>
                    <p>Объектный стиль никак не повлиял на алгоритм решения. Кода не стало меньше, он не стал проще. С
                      другой стороны, такой подход в PHP распространен крайне широко.</p>


</body>

</html>